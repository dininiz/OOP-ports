<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Document</title>
</head>
<body>
    <div class="container" id="container">
        <div class="grids"></div>
    </div>
    
</body>
<script>
    let container = document.getElementById("container");
    let grids = document.querySelector(".grids");

    for (let i = 1; i <= 42; i++) {
        for (let j = 1; j <= 64; j++) {
            let square = document.createElement("div");
            square.className = "square";
            square.id = `${i}-${j}`;
            grids.appendChild(square);
        }
    }

    // // Add event listener for mouse wheel zoom
    // container.addEventListener("wheel", function(event) {
    //     event.preventDefault();
    //     let scale = 1 + event.deltaY * -0.01;
    //     container.style.transform = `scale(${scale})`;
    // });
</script>
<!-- <script>
    let currentZoom = 1;
    let minZoom = 1;
    let maxZoom = 5;
    let stepSize = 0.2;

    let _startX = 0;
    let _startY = 0;
    let _offsetX = 0;
    let _offsetY = 0;
    let _dragElement = null;

    let container = document.getElementById("container");

    container.addEventListener("wheel", function (event) {
        // Zoom in or out based on the scroll direction
        let direction = event.deltaY > 0 ? -1 : 1;
        zoomImage(direction);
    });

    function zoomImage(direction) {
        let newZoom = currentZoom + direction * stepSize;

        // Limit the zoom level to the minimum and maximum values
        if (newZoom < minZoom || newZoom > maxZoom) {
            return;
        }

        currentZoom = newZoom;

        // Update the CSS transform of the image to scale it
        container.style.transform = "scale(" + currentZoom + ")";
        console.log("Zoom level: " + currentZoom);

        // Set the transform origin to the center when zooming out
        if (currentZoom <= 1) {
            container.style.transformOrigin = "center center";
            centerContainer();
        }
    }

    function centerContainer() {
        // Calculate the center position based on the viewport size
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        const containerWidth = container.offsetWidth;
        const containerHeight = container.offsetHeight;

        // Center the container
        container.style.left = (viewportWidth - containerWidth) / 2 + "px";
        container.style.top = (viewportHeight - containerHeight) / 2 + "px";
    }
    function OnMouseDown(event) {
        // Allow dragging only when zoom level is greater than 1
        if (currentZoom > 1) {
            document.onmousemove = OnMouseMove;
            _startX = event.clientX;
            _startY = event.clientY;
            _offsetX = container.offsetLeft;
            _offsetY = container.offsetTop;
            _dragElement = container;
        }
    }

    function OnMouseMove(event) {
        if (_dragElement) {
            _dragElement.style.left = _offsetX + event.clientX - _startX + "px";
            _dragElement.style.top = _offsetY + event.clientY - _startY + "px";
        }
    }

    function OnMouseUp(event) {
        document.onmousemove = null;
        _dragElement = null;
    }

    // Attach mouse event listeners
    document.onmousedown = OnMouseDown;
    document.onmouseup = OnMouseUp;

</script> -->
<script>
    // === Add dark-square class based on image brightness ===
    // 1. Create a hidden canvas and load the image
    const img = new Image();
    img.src = 'img/world2.png';
    img.crossOrigin = 'Anonymous';
    img.onload = function() {
        // Create a hidden canvas
        const canvas = document.createElement('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        canvas.style.display = 'none';
        document.body.appendChild(canvas);
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);

        // Get grid and square size
        const gridRows = 42;
        const gridCols = 64;
        const gridRect = grids.getBoundingClientRect();
        const squareWidth = gridRect.width / gridCols;
        const squareHeight = gridRect.height / gridRows;

        for (let i = 1; i <= gridRows; i++) {
            for (let j = 1; j <= gridCols; j++) {
                // Calculate the center of the square in image coordinates
                const x = Math.floor((j - 0.5) * img.width / gridCols);
                const y = Math.floor((i - 0.5) * img.height / gridRows);
                let pixel;
                try {
                    pixel = ctx.getImageData(x, y, 1, 1).data;
                } catch (e) {
                    continue; // skip if out of bounds or error
                }
                const isDark = pixel[3] > 0;
                if (isDark) {
                    const square = document.getElementById(`${i}-${j}`);
                    if (square) square.classList.add('square-dark');
                }
            }
        }
        // Optionally, remove the canvas after use
        document.body.removeChild(canvas);
    };
</script>
</html>